<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Website Builder | Multi-Model Debate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { min-height: 100dvh; display: flex; flex-direction: column; overflow: hidden; background-color: #0f172a; color: #f8fafc; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .sidebar-scroll { height: calc(100vh - 200px); overflow-y: auto; }
        iframe { background: white; border-radius: 8px; width: 100%; height: 100%; border: none; }
        .loader { width: 20px; height: 20px; border: 3px solid #334155; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="flex flex-1 overflow-hidden">
    <aside class="w-64 glass-panel flex flex-col p-4 z-20">
        <button onclick="createNewProject()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition mb-6 flex items-center justify-center gap-2">
            <span>+</span> New Project
        </button>
        
        <div class="flex-1">
            <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Project History</h3>
            <div id="projectList" class="sidebar-scroll space-y-2"></div>
        </div>

        <button onclick="toggleSettings(true)" class="mt-auto p-2 hover:bg-slate-800 rounded-lg flex items-center gap-2 text-slate-400">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
            API Settings
        </button>
    </aside>

    <main class="flex-1 flex flex-col min-w-0">
        <header class="h-14 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900">
            <div class="flex gap-2">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            <div id="statusIndicator" class="text-xs text-slate-500 italic">Ready</div>
            <button onclick="downloadCode()" class="bg-slate-800 hover:bg-slate-700 text-slate-200 text-sm px-4 py-1.5 rounded-lg border border-slate-700 transition">Download</button>
        </header>

        <section class="flex-1 p-4">
            <iframe id="outputFrame"></iframe>
        </section>

        <div id="debateProgress" class="mx-4 p-2 bg-slate-950 rounded border border-slate-800 hidden text-[10px] font-mono text-blue-400 grid grid-cols-5 gap-2">
            <div id="m1">Model 1: Waiting...</div>
            <div id="m2">Model 2: Waiting...</div>
            <div id="m3">Model 3: Waiting...</div>
            <div id="m4">Model 4: Waiting...</div>
            <div id="m5">Model 5: Waiting...</div>
        </div>

        <footer class="p-4 bg-slate-900 flex-shrink-0">
            <div class="max-w-4xl mx-auto flex gap-3 bg-slate-800 p-2 rounded-xl border border-slate-700">
                <textarea id="userInput" placeholder="Ask for a full-stack dashboard..." class="flex-1 bg-transparent border-none focus:ring-0 text-slate-200 py-2 px-3 h-12" rows="1"></textarea>
                <button id="sendBtn" onclick="runDebateFlow()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 rounded-lg font-medium transition flex items-center gap-2">
                    Generate Best
                </button>
            </div>
        </footer>
    </main>
</div>

<div id="settingsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center">
    <div class="bg-slate-900 border border-slate-800 w-full max-w-md rounded-2xl p-6">
        <h2 class="text-xl font-bold mb-4">Master Configuration</h2>
        <div class="space-y-4">
            <input id="apiUrl" type="text" placeholder="API URL" class="w-full bg-slate-800 border-slate-700 rounded-lg px-4 py-2 text-sm">
            <input id="apiKey" type="password" placeholder="API Key" class="w-full bg-slate-800 border-slate-700 rounded-lg px-4 py-2 text-sm">
            <input id="modelId" type="text" placeholder="Worker Models (e.g. gpt-4o)" class="w-full bg-slate-800 border-slate-700 rounded-lg px-4 py-2 text-sm">
            <input id="judgeId" type="text" placeholder="Judge Model (e.g. deepseek-r1)" class="w-full bg-slate-800 border-slate-700 rounded-lg px-4 py-2 text-sm">
        </div>
        <button onclick="saveSettings()" class="w-full mt-6 bg-blue-600 py-2 rounded-lg font-medium">Save & Close</button>
    </div>
</div>

<script>
    let state = {
        currentCode: '',
        projects: JSON.parse(localStorage.getItem('projects') || '[]'),
        settings: JSON.parse(localStorage.getItem('settings') || JSON.stringify({
            url: 'https://openrouter.ai/api/v1/chat/completions',
            key: '',
            model: 'google/gemini-flash-1.5-exp',
            judge: 'deepseek/deepseek-r1:free'
        }))
    };

    function saveSettings() {
        state.settings = {
            url: document.getElementById('apiUrl').value,
            key: document.getElementById('apiKey').value,
            model: document.getElementById('modelId').value,
            judge: document.getElementById('judgeId').value
        };
        localStorage.setItem('settings', JSON.stringify(state.settings));
        toggleSettings(false);
    }

    async function fetchModel(prompt, model, logId) {
        try {
            const res = await fetch(state.settings.url, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${state.settings.key}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ model: model, messages: [{role: "user", content: prompt}] })
            });
            const text = await res.text();
            if (!res.ok) throw new Error(text);
            const data = JSON.parse(text);
            document.getElementById(logId).innerText = "Complete ✅";
            return data.choices[0].message.content;
        } catch (e) {
            document.getElementById(logId).innerText = "Error ❌";
            return "";
        }
    }

    async function runDebateFlow() {
        const prompt = document.getElementById('userInput').value;
        if (!state.settings.key) return toggleSettings(true);

        const btn = document.getElementById('sendBtn');
        const progress = document.getElementById('debateProgress');
        btn.disabled = true;
        progress.classList.remove('hidden');

        // 1. Fire 5 Workers
        const workers = ['m1','m2','m3','m4','m5'].map(id => fetchModel(
            `Generate a single-file website code for: ${prompt}. Output ONLY code.`, 
            state.settings.model, id
        ));

        const results = await Promise.all(workers);
        
        // 2. The Judge Debates
        document.getElementById('statusIndicator').innerText = "Judge is evaluating...";
        const judgePrompt = `Review these 5 website codes and provide the single absolute BEST version. Fix any bugs and ensure it is full-stack ready. CODE ONLY:\n\n${results.join('\n---NEXT VERSION---\n')}`;
        
        const finalCode = await fetchModel(judgePrompt, state.settings.judge, 'statusIndicator');
        const cleanCode = finalCode.replace(/```html|```/gi, '').trim();

        updateProject(cleanCode, prompt);
        btn.disabled = false;
        progress.classList.add('hidden');
    }

    function updateProject(code, prompt) {
        state.currentCode = code;
        const newProj = { id: Date.now(), title: prompt.substring(0,25), code };
        state.projects.unshift(newProj);
        localStorage.setItem('projects', JSON.stringify(state.projects));
        document.getElementById('outputFrame').srcdoc = code;
        renderHistory();
    }

    function renderHistory() {
        document.getElementById('projectList').innerHTML = state.projects.map(p => `
            <div onclick="load(${p.id})" class="p-2 text-xs bg-slate-800 rounded cursor-pointer hover:bg-slate-700 truncate">${p.title}</div>
        `).join('');
    }

    function load(id) {
        const p = state.projects.find(x => x.id === id);
        document.getElementById('outputFrame').srcdoc = p.code;
        state.currentCode = p.code;
    }

    function toggleSettings(s) { document.getElementById('settingsModal').classList.toggle('hidden', !s); }
    function createNewProject() { document.getElementById('outputFrame').srcdoc = ''; state.currentCode = ''; }
    
    window.onload = () => {
        document.getElementById('apiUrl').value = state.settings.url;
        document.getElementById('apiKey').value = state.settings.key;
        document.getElementById('modelId').value = state.settings.model;
        document.getElementById('judgeId').value = state.settings.judge;
        renderHistory();
    };
</script>
</body>
</html>
